---
title: "BaCup"
output: html_document
---
How I built the model:
First, the question we want to answer in this project with is what data collected by different fitness devices can help us to predict the manner in which our participants exercise? 
The data we use are sourced from http://groupware.les.inf.puc-rio.br/har. 

```{r}
###################
#   Read in data
###################
library(caret)
library(ggplot)
library(knitr)
training=read.csv(file="pml-training.csv",header=TRUE, sep=",")
testing=read.csv(file="pml-testing.csv",header=TRUE, sep=",")
#################################################
#   Delete columns with a lot of NAs 
#################################################
levels(training[,2])  #Check for the number of users and their names
levels(training$classe)
NAcolInd=(union(which(colSums(is.na(training))>0),which(colSums(is.na(testing))>0)))
deleteCol=NAcolInd[order(NAcolInd)]
training=training[,-deleteCol] 
#################################################
#   Set training and testing data 
#################################################
inTrain<-createDataPartition(y=training$classe,p=0.7,list=FALSE)
train<-training[inTrain,]
tests<-training[-inTrain,]
#################################################
#   Pick out variables with high correlations (>0.8) 
#################################################
nrows=dim(training)[1]
corre=cor(training[2:nrows,7:59])
diag(corre)=0
which(corre > 0.9, arr.ind=TRUE,useNames=TRUE)
corind= c(2, 4, 5, 9,10,12,25,26,27,29,30,35,37,46,47)
corind=corind+6
colnames(training[1,corind])
corr2=cor(training[2:nrows,corind])
#######################################################################
#   Train data with random forest with only the selected variables
#######################################################################

library(gclus)
control<-trainControl(method="repeatedcv",number=10, repeats=3)
set.seed(333)
#Using random forest 
modelrf<-train(classe ~total_accel_belt+total_accel_dumbbell+total_accel_arm+total_accel_forearm,data=training, preProcess="center",method="rf")
print(modelrf)
modelrf$finalModel
test.pred<-predict(modelrf,tests)
confusionMatrix(tests$classe,test.pred)
```


Finally, predict the 20 cases:
```{r}
answer.pred<-predict(modelrf,testing)
Index<-1:20
results=cbind(Index,answer.pred)

```

Plots: 

```{r, echo=FALSE}
featurePlot(x=training[,c("total_accel_belt","total_accel_dumbbell","total_accel_forearm")],y=training$classe,plot="pairs")

library(plot3D)
with(train, scatter3D(magnet_arm_x, magnet_arm_y, magnet_arm_z,col=1:6, colvar=as.numeric(train$classe), theta=90, main="magnet arm, by classe"))
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
